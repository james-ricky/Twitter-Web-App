<div class="page">

  <div class="divider"></div>

  <div class="panel panel-default">
    <div class="panel-heading">
      <strong><span class="glyphicon glyphicon-th"></span>{{ 'users.searches.field.editSearch' | translate }}</strong>
    </div>
    <div class="panel-body">

      <div class="alert alert-danger" ng-if="updateSearchForm.$submitted &amp;&amp; updateSearchForm.$invalid">
        <ng-messages
          for="updateSearchForm.newSearchName.$error" ng-if="updateSearchForm.newSearchName.$invalid">
          <p ng-message="required">
            <div>{{ 'users.searches.field.newSearchName' | translate }}</div>
          </ng-message>
        </ng-messages>
        <ng-messages
          for="updateSearchForm.newSearchPurpose.$error" ng-if="updateSearchForm.newSearchPurpose.$invalid">
          <p ng-message="required">
            <div>{{ 'users.searches.field.provideSearchPurpose' | translate }}</div>
          </ng-message>
        </ng-messages>
        <ng-messages
          for="updateSearchForm.newSearchIndustry.$error" ng-if="updateSearchForm.newSearchIndustry.$invalid">
          <p ng-message="required">
            <div>{{ 'users.searches.field.provideIndustryForSearch' | translate }}</div>
          </ng-message>
        </ng-messages>
      </div>

      <form novalidate name="updateSearchForm" ng-submit="usersSearchEdit.updateSearch()">
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="">{{ 'users.searches.field.name' | translate }}</label>
              <i class="ti-help-alt" tooltip-placement="right" tooltip="{{ 'users.searches.field.name' | translate }}" tooltip-append-to-body="true"></i>
              <input autofocus name="newSearchName" type="text" class="form-control ng-pristine" required="" data-ng-model="usersSearchEdit.search.name">
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-12">
            <div class="form-group">
              <label for="">{{ 'users.searches.field.searchPurpose' | translate }}</label>
              <i class="ti-help-alt" tooltip-placement="right" tooltip="{{ 'users.searches.field.searchPurpose' | translate }}" tooltip-append-to-body="true"></i>

              <br/>

              <span class="ui-select">
                <select name="newSearchPurpose" ng-model="usersSearchEdit.search.searchPurpose" ng-options="searchPurpose as searchPurpose.name for searchPurpose in usersSearchEdit.allSearchPurposes" required="">
                  <option value="">--- {{ 'users.searches.field.selectOne' | translate }} ---</option>
                </select>
              </span>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-12">
            <div class="form-group">
              <label for="">{{ 'users.searches.field.relevantIndustry' | translate }}</label>
              <i class="ti-help-alt" tooltip-placement="right" tooltip="{{ 'users.searches.field.relevantIndustry' | translate }}" tooltip-append-to-body="true"></i>
              <br/>

              <span class="ui-select">
                <select name="newSearchIndustry" ng-model="usersSearchEdit.search.industry" ng-options="industry as industry.name for industry in usersSearchEdit.allIndustries" required="">
                  <option value="">--- {{ 'users.searches.field.selectOne' | translate }} ---</option>
                </select>
              </span>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-12">
            <div class="form-group">
              <label for="">{{ 'users.searches.field.targetGeography' | translate }}</label>
              <i class="ti-help-alt" tooltip-placement="right" tooltip="{{ 'users.searches.field.location' | translate }}" tooltip-append-to-body="true"></i>

              <br/>

              <div
                ivh-treeview="usersSearchEdit.search.continents"
                ivh-treeview-label-attribute="'name'">
              </div>
            </div>
          </div>
        </div>

        <div class="divider divider-dashed"></div>
        <div class="divider divider-lg"></div>

        <div class="row">
          <div class="col-md-4">
            <div class="form-group">
              <label for="">{{ 'users.searches.field.startDate' | translate }}</label>
              <i class="ti-help-alt" tooltip-placement="right" tooltip="{{ 'users.searches.field.startDate' | translate }}" tooltip-append-to-body="true"></i>
              <div class="row">
                <div class="col-md-6">
                  <div class="input-group ui-datepicker">
                    <input type="text"
                       class="form-control"
                       datepicker-popup="yyyy-MM-dd"
                       ng-model="usersSearchEdit.search.startDate"
                       is-open="usersSearchEdit.search.startDateOpened"
                       min-date="usersSearchEdit.search.minDate"
                       datepicker-options="usersSearchEdit.dateOptions"
                       ng-required="true"
                       close-text="Close">
                     <span class="input-group-addon" ng-click="usersSearchEdit.toggleOpenStartDate($event)"><i class="ti-calendar"></i></span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-4">
            <div class="form-group">
              <label for="">{{ 'users.searches.field.endDate' | translate }}</label>
              <i class="ti-help-alt" tooltip-placement="right" tooltip="{{ 'users.searches.field.endDate' | translate }}" tooltip-append-to-body="true"></i>

              <div class="row">
                <div class="col-md-4">
                  <label class="ui-checkbox search-checkbox">
                    <input type="checkbox" ng-model="usersSearchEdit.search.neverEnd" ><span>{{ 'users.searches.field.neverEnd' | translate }}</span>
                  </label>
                </div>

                <div class="col-md-6" ng-if="!usersSearchEdit.search.neverEnd">
                  <div class="input-group ui-datepicker">
                    <input type="text"
                       class="form-control"
                       datepicker-popup="yyyy-MM-dd"
                       ng-model="usersSearchEdit.search.endDate"
                       is-open="usersSearchEdit.search.endDateOpened"
                       min-date="usersSearchEdit.search.startDate"
                       datepicker-options="usersSearchEdit.dateOptions"
                       ng-required="true"
                       close-text="Close">
                    <span class="input-group-addon" ng-click="usersSearchEdit.toggleOpenEndDate($event)"><i class="ti-calendar"></i></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-12">
            <div class="form-group">
              <div class="row">
                <div class="col-md-12">
                  <label for="">{{ 'users.searches.field.sources' | translate }}</label>
                  <i class="ti-help-alt" tooltip-placement="right" tooltip="{{ 'users.searches.field.dataSources' | translate }}" tooltip-append-to-body="true"></i>
                </div>
              </div>

              <div class="row">
                <div class="col-md-1">
                  <label class="ui-radio">
                    <input type="radio" ng-value="true" ng-model="usersSearchEdit.search.allSources">
                    <span>{{ 'users.searches.field.all' | translate }}</span>
                  </label>
                </div>
                <div class="col-md-11">
                  <label class="ui-radio">
                    <input type="radio" ng-value="false" ng-model="usersSearchEdit.search.allSources">
                    <span>{{ 'users.searches.field.onlySelected' | translate }}</span>
                  </label>

                  <br/>
                  <div class="radio-selected-checkbox-group" ng-if="usersSearchEdit.search.allSources === false">
                    <label class="ui-checkbox" ng-repeat="searchSource in usersSearchEdit.allSearchSources">
                      <input type="checkbox" ng-model="usersSearchEdit.search.searchSources[searchSource.id]" ng-value="searchSource.id">
                      <span>{{ searchSource.name }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="divider divider-dashed"></div>
        <div class="divider divider-lg"></div>

        <div class="panel panel-default" ng-repeat="keywordGroup in usersSearchEdit.search.keywordGroups">
          <div class="panel-heading">
            <div class="pull-right">
              <a ng-click="usersSearchEdit.deleteKeywordGroup($index)" class="panel-action-links">
                <i class="ti-minus"></i>
              </a>
            </div>
            <strong><span class="glyphicon glyphicon-th"></span> {{ 'users.searches.field.keywordGroup' | translate }} {{ $index + 1 }}</strong>

            <i class="ti-help-alt" tooltip-placement="right" tooltip="{{ 'users.searches.field.keywordGroup' | translate }}" tooltip-append-to-body="true"></i>

          </div>
          <div class="panel-body">
            <div class="row">
              <div class="col-md-12">
                <div class="form-group">
                  <div class="row">
                    <div class="col-md-12">
                      <label for="">{{ 'users.searches.field.language' | translate }}</label>
                      <i class="ti-help-alt" tooltip-placement="right" tooltip="{{ 'users.searches.field.languageFor' | translate }}" tooltip-append-to-body="true"></i>

                      <br/>

                      <span class="ui-select">
                        <select ng-model="keywordGroup.language">
                          <option value="en">{{ 'users.searches.field.english' | translate }}</option>
                          <option value="zh-TW">{{ 'users.searches.field.traditionalChinese' | translate }}</option>
                          <option value="zh-CN">{{ 'users.searches.field.simplifiedChinese' | translate }}</option>
                          <option value="id">{{ 'users.searches.field.indonesian' | translate }}</option>
                          <option value="ja">{{ 'users.searches.field.japanese' | translate }}</option>
                          <option value="ko">{{ 'users.searches.field.korean' | translate }}</option>
                          <option value="ms">{{ 'users.searches.field.malaysian' | translate }}</option>
                          <option value="nl">{{ 'users.searches.field.dutch' | translate }}</option>
                          <option value="fr">{{ 'users.searches.field.french' | translate }}</option>
                          <option value="de">{{ 'users.searches.field.german' | translate }}</option>
                          <option value="it">{{ 'users.searches.field.italian' | translate }}</option>
                          <option value="es">{{ 'users.searches.field.spanish' | translate }}</option>
                        </select>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="">{{ 'users.searches.field.mustIncludeAll' | translate }}</label>
                  <i class="ti-help-alt" tooltip-placement="right" tooltip="{{ 'users.searches.field.searchTerms' | translate }}" tooltip-append-to-body="true"></i>
                  <br/>

                  <tags-input placeholder="{{ 'users.searches.field.addKeywords' | translate }}" replace-spaces-with-dashes="false" min-length="1" ng-model="keywordGroup.containsAll" ng-keyup="usersSearchEdit.detectChineseCharacter([keywordGroup, $event])" class="ui-tags-input"></tags-input>
                </div>

                <div class="form-group">
                  <label for="">{{ 'users.searches.field.mustNotIncludeAll' | translate }}</label>
                  <i class="ti-help-alt" tooltip-placement="right" tooltip="{{ 'users.searches.field.searchTerms' | translate }}" tooltip-append-to-body="true"></i>
                  <br/>

                  <tags-input placeholder="{{ 'users.searches.field.addKeywords' | translate }}" replace-spaces-with-dashes="false" min-length="1" ng-model="keywordGroup.notContainsAll" ng-keyup="usersSearchEdit.detectChineseCharacter([keywordGroup, $event])" class="ui-tags-input"></tags-input>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-group">
                  <label for="">{{ 'users.searches.field.mustIncludeAtLeast' | translate }}</label>
                  <i class="ti-help-alt" tooltip-placement="right" tooltip="{{ 'users.searches.field.searchTerms' | translate }}" tooltip-append-to-body="true"></i>
                  <br/>

                  <tags-input placeholder="{{ 'users.searches.field.addKeywords' | translate }}" replace-spaces-with-dashes="false" min-length="1" ng-model="keywordGroup.containsAny" ng-keyup="usersSearchEdit.detectChineseCharacter([keywordGroup, $event])" class="ui-tags-input"></tags-input>
                </div>

                <div class="form-group">
                  <label for="">{{ 'users.searches.field.mustNotIncludeAtLeast' | translate }}</label>
                  <i class="ti-help-alt" tooltip-placement="right" tooltip="{{ 'users.searches.field.searchTerms' | translate }}" tooltip-append-to-body="true"></i>
                  <br/>

                  <tags-input placeholder="{{ 'users.searches.field.addKeywords' | translate }}" replace-spaces-with-dashes="false" min-length="1" ng-model="keywordGroup.notContainsAny" ng-keyup="usersSearchEdit.detectChineseCharacter([keywordGroup, $event])" class="ui-tags-input"></tags-input>
                </div>
              </div>
            </div>
          </div>
        </div>

        <a ng-click="usersSearchEdit.addKeywordGroup()" class="btn btn-block btn-default">
          {{ 'users.searches.field.addKeywordGroup' | translate }}
        </a>

        <div class="divider divider-lg"></div>

        <input type="submit" value="{{ 'users.searches.field.update' | translate }}" class="btn btn-primary" ng-disabled="updateSearchForm.$invalid">
      </form>
    </div>
  </div>
</div>
